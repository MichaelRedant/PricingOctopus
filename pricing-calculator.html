<style>
  .octo-calculator {
    --accent: #306b91;
    --accent-soft: rgba(48, 107, 145, 0.08);
    --border: #dfe1eb;
    --bg-muted: #f7f8fc;
    font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: #fff;
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 28px;
    color: #222;
    box-shadow: 0 10px 40px rgba(48, 107, 145, 0.12);
    max-width: 1180px;
    margin: 0 auto;
    position: relative;
    overflow: hidden;
  }
  .octo-calculator::before,
  .octo-calculator::after {
    content: "";
    position: absolute;
    inset: -120px auto auto -120px;
    width: 220px;
    height: 220px;
    background: radial-gradient(circle at center, rgba(48, 107, 145, 0.18), transparent 70%);
    z-index: 0;
    filter: blur(0);
  }
  .octo-calculator::after {
    inset: auto -120px -120px auto;
  }
  .octo-calculator > * {
    position: relative;
    z-index: 1;
  }
  .octo-calculator h2 {
    margin: 0 0 8px;
    font-size: 1.6rem;
    color: #111;
  }
  .octo-calculator p.lead {
    margin: 0 0 24px;
    color: #555;
  }
  .octo-hero {
    display: grid;
    gap: 18px;
    margin-bottom: 28px;
  }
  .octo-hero__intro {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .octo-hero__badge {
    align-self: flex-start;
    background: linear-gradient(120deg, rgba(48, 107, 145, 0.85), rgba(92, 164, 199, 0.85));
    color: #fff;
    padding: 6px 14px;
    border-radius: 999px;
    font-size: 0.78rem;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    font-weight: 600;
    box-shadow: 0 8px 18px rgba(48, 107, 145, 0.25);
  }
  .octo-hero__steps {
    display: grid;
    gap: 14px;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  }
  .octo-step {
    background: rgba(255, 255, 255, 0.85);
    border-radius: 14px;
    border: 1px solid rgba(48, 107, 145, 0.12);
    padding: 14px 16px;
    display: grid;
    gap: 6px;
    box-shadow: 0 10px 24px rgba(17, 23, 62, 0.08);
    transform: translateY(16px);
    opacity: 0;
    animation: floatIn 0.6s ease forwards;
  }
  .octo-step:nth-child(2) {
    animation-delay: 0.12s;
  }
  .octo-step:nth-child(3) {
    animation-delay: 0.24s;
  }
  .octo-step strong {
    font-size: 0.95rem;
    color: #111;
  }
  .octo-step span {
    font-size: 0.85rem;
    color: #5a5f75;
    line-height: 1.4;
  }
  .octo-layout {
    display: grid;
    grid-template-columns: minmax(0, 3fr) minmax(260px, 1fr);
    gap: 24px;
  }
  .octo-panel {
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px;
    background: #fff;
    box-shadow: 0 10px 20px rgba(21, 27, 71, 0.04);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .octo-panel:hover {
    transform: translateY(-4px);
    box-shadow: 0 14px 30px rgba(21, 27, 71, 0.12);
  }
  .octo-panel + .octo-panel {
    margin-top: 16px;
  }
  .octo-panel h3 {
    margin: 0 0 12px;
    font-size: 1.2rem;
    color: #1f2233;
  }
  .octo-panel h4 {
    margin: 20px 0 8px;
    font-size: 1rem;
    color: #1f2233;
  }
  .octo-fields {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 12px;
  }
  .octo-field {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .octo-field label {
    font-size: 0.88rem;
    color: #555;
  }
  .octo-field input,
  .octo-field select {
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 8px 10px;
    font-size: 0.95rem;
  }
  .octo-field input[type="checkbox"] {
    width: auto;
  }
  .octo-tagline {
    font-size: 0.85rem;
    color: #666;
  }
  .octo-summary {
    background: var(--bg-muted);
    border-radius: 14px;
    border: 1px solid var(--border);
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    position: sticky;
    top: 12px;
    align-self: flex-start;
    box-shadow: 0 12px 28px rgba(21, 27, 71, 0.08);
    transition: transform 0.3s ease;
  }
  .octo-summary h3 {
    margin: 0;
    font-size: 1.25rem;
  }
  .octo-totals {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 12px;
  }
  .octo-totals div {
    background: #fff;
    border-radius: 10px;
    border: 1px solid #ebecf3;
    padding: 12px;
    text-align: center;
    transition: transform 0.25s ease, box-shadow 0.25s ease;
  }
  .octo-totals div.is-lifted {
    transform: translateY(-4px);
    box-shadow: 0 12px 24px rgba(48, 107, 145, 0.18);
  }
  .octo-totals span {
    display: block;
    font-weight: 600;
    font-size: 1.15rem;
    margin-top: 6px;
    color: var(--accent);
    transition: color 0.3s ease;
  }
  .octo-totals span.is-updating {
    animation: pulse 0.65s ease;
    color: #222;
  }
  .octo-breakdown {
    max-height: 260px;
    overflow: auto;
    border: 1px dashed var(--border);
    border-radius: 12px;
    padding: 12px;
    background: #fff;
  }
  .octo-breakdown li {
    list-style: none;
    padding: 6px 0;
    border-bottom: 1px solid #f0f1f7;
    font-size: 0.9rem;
    color: #444;
  }
  .octo-breakdown li strong {
    color: #111;
  }
  .octo-breakdown li:last-child {
    border-bottom: none;
  }
  .octo-note {
    font-size: 0.78rem;
    color: #6a6f85;
    line-height: 1.5;
  }
  .octo-chip {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(48, 107, 145, 0.08);
    color: var(--accent);
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 0.78rem;
    margin-bottom: 10px;
  }
  .octo-guide {
    background: rgba(255, 255, 255, 0.9);
    border: 1px dashed rgba(48, 107, 145, 0.3);
    border-radius: 14px;
    padding: 16px;
    margin: 16px 0 0;
    display: grid;
    gap: 10px;
  }
  .octo-guide strong {
    color: #1c2153;
  }
  .octo-guide ul {
    margin: 0;
    padding-left: 18px;
    color: #4d5165;
    font-size: 0.85rem;
    line-height: 1.5;
  }
  .octo-quickstart {
    background: #fff;
    border-radius: 12px;
    border: 1px solid rgba(48, 107, 145, 0.16);
    padding: 12px 14px;
    display: grid;
    gap: 10px;
  }
  .octo-quickstart strong {
    font-size: 0.95rem;
    color: #12152f;
  }
  .octo-quickstart ol {
    margin: 0;
    padding-left: 20px;
    color: #4c5171;
    font-size: 0.85rem;
    line-height: 1.45;
  }
  .octo-quickstart li + li {
    margin-top: 6px;
  }
  .octo-tip {
    background: var(--accent-soft);
    border-radius: 10px;
    padding: 10px 12px;
    font-size: 0.8rem;
    color: #3a3f60;
    display: flex;
    gap: 8px;
    align-items: flex-start;
  }
  .octo-tip svg {
    flex-shrink: 0;
  }
  details.octo-faq {
    border: 1px solid rgba(48, 107, 145, 0.16);
    border-radius: 12px;
    padding: 12px 16px;
    background: rgba(255, 255, 255, 0.92);
    font-size: 0.85rem;
    color: #3a3f60;
  }
  details.octo-faq + details.octo-faq {
    margin-top: 10px;
  }
  details.octo-faq summary {
    cursor: pointer;
    font-weight: 600;
    color: #1c2153;
    margin: -4px -4px 6px;
    padding: 4px;
    list-style: none;
  }
  details.octo-faq summary::-webkit-details-marker {
    display: none;
  }
  details.octo-faq ul {
    margin: 6px 0 0;
    padding-left: 18px;
    line-height: 1.45;
  }
  .octo-hidden {
    display: none !important;
  }
  @keyframes floatIn {
    from {
      opacity: 0;
      transform: translateY(16px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  @keyframes pulse {
    0% {
      transform: scale(1);
    }
    40% {
      transform: scale(1.05);
    }
    100% {
      transform: scale(1);
    }
  }
  @media (prefers-reduced-motion: reduce) {
    .octo-step,
    .octo-panel,
    .octo-summary,
    .octo-totals div,
    .octo-totals span {
      animation: none !important;
      transition: none !important;
    }
  }
  @media (max-width: 960px) {
    .octo-layout {
      grid-template-columns: 1fr;
    }
    .octo-summary {
      position: relative;
      top: auto;
    }
  }
</style>

<div class="octo-calculator" data-octo-calculator>
  <div class="octo-hero">
    <div class="octo-hero__intro">
      <span class="octo-hero__badge">Welkom collega's</span>
      <h2>Octopus prijscalculator</h2>
      <p class="lead">Alle bedragen zijn excl. 21% btw. Gebruik deze gids om snel offertes op maat te bouwen voor U-, K- of B-dossiers.</p>
      <div class="octo-tip">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M8 1.333a6.667 6.667 0 1 1 0 13.334A6.667 6.667 0 0 1 8 1.333Z" stroke="#306b91" stroke-width="1.2"/>
          <path d="M8 4.667v4" stroke="#306b91" stroke-width="1.2" stroke-linecap="round"/>
          <circle cx="8" cy="10.667" r="0.667" fill="#306b91"/>
        </svg>
        <span><strong>Tip:</strong> werk stap voor stap. Start met het juiste dossiertype, vul daarna de modules en sluit af met eventuele extra diensten.</span>
      </div>
    </div>
    <div class="octo-hero__steps">
      <div class="octo-step">
        <strong>Stap 1 · Basis</strong>
        <span>Kies het dossiertype en geef aan hoeveel dossiers je nodig hebt. De calculator past de juiste prijsprofielen meteen toe.</span>
      </div>
      <div class="octo-step">
        <strong>Stap 2 · Modules</strong>
        <span>Activeer de modules per dossier. Krijg instant feedback over de maandelijkse en jaarlijkse impact.</span>
      </div>
      <div class="octo-step">
        <strong>Stap 3 · Extra diensten</strong>
        <span>Voeg trainingen, support of consultatie toe. De eenmalige kosten verschijnen automatisch in het overzicht.</span>
      </div>
    </div>
  </div>

  <div class="octo-layout">
    <div>
      <div class="octo-panel">
        <div class="octo-field">
          <label for="octo-dossier-type">Dossiertype</label>
          <select id="octo-dossier-type" data-field="dossierType">
            <option value="u">U-dossier (ondernemer betaalt zelf)</option>
            <option value="k">K-dossier (via kantoor, ~20% korting & geen opstart)</option>
            <option value="b">B-dossier (accountantslicentie voor kantoren)</option>
          </select>
        </div>
        <p class="octo-tagline">U- en K-dossiers hebben dezelfde modules. K-dossiers ontvangen automatisch ~20% korting op licenties en opties.</p>
        <div class="octo-guide" id="octo-guide">
          <strong>Zo werkt dit profiel:</strong>
          <ul>
            <li>U-dossiers zijn bedoeld voor ondernemers die hun licentie zelf betalen.</li>
            <li>Bank-, facturatie- en extra lijnmodules kan je per dossier activeren.</li>
            <li>Krijg zicht op de impact door waarden in te vullen: alles wordt realtime doorgerekend.</li>
          </ul>
        </div>
      </div>

      <div class="octo-panel" data-section="uk">
        <div class="octo-chip">Klantenportaal & facturatie</div>
        <div class="octo-fields">
          <div class="octo-field">
            <label for="octo-portal-qty"># dossiers (basislicentie)</label>
            <input type="number" id="octo-portal-qty" min="0" value="0" data-field="portalQty">
          </div>
          <div class="octo-field">
            <label for="octo-portal-extra-lines">Extra lijnbundels (x15.000)</label>
            <input type="number" id="octo-portal-extra-lines" min="0" value="0" data-field="portalExtraLines">
            <small class="octo-note">Activeren vanaf het 2e jaar.</small>
          </div>
          <div class="octo-field">
            <label for="octo-portal-extra-dossiers">Multi-dossier packs (+5)</label>
            <input type="number" id="octo-portal-extra-dossiers" min="0" value="0" data-field="portalExtraPacks">
          </div>
          <div class="octo-field">
            <label for="octo-portal-bank">Bankmodules</label>
            <input type="number" id="octo-portal-bank" min="0" value="0" data-field="portalBankQty">
          </div>
        </div>
        <h4>Boekhoudprogramma (volledige boekhouding)</h4>
        <div class="octo-fields">
          <div class="octo-field">
            <label for="octo-small-qty">Small (tot 4.000 lijnen)</label>
            <input type="number" id="octo-small-qty" min="0" value="0" data-field="smallQty">
          </div>
          <div class="octo-field">
            <label for="octo-medium-qty">Medium (tot 10.000 lijnen)</label>
            <input type="number" id="octo-medium-qty" min="0" value="0" data-field="mediumQty">
          </div>
          <div class="octo-field">
            <label for="octo-large-qty">Large (tot 30.000 lijnen)</label>
            <input type="number" id="octo-large-qty" min="0" value="0" data-field="largeQty">
          </div>
          <div class="octo-field">
            <label for="octo-accounting-extra-lines">Extra lijnbundels (x30.000)</label>
            <input type="number" id="octo-accounting-extra-lines" min="0" value="0" data-field="accountingExtraPacks">
            <small class="octo-note">Vanaf 2e jaar bij >30k lijnen.</small>
          </div>
        </div>
        <h4>Optionele modules (per dossier)</h4>
        <div class="octo-fields">
          <div class="octo-field">
            <label for="octo-bookkeeping-extra-dossiers">Extra dossiers pakket (+5)</label>
            <input type="number" id="octo-bookkeeping-extra-dossiers" min="0" value="0" data-field="accountingExtraPacksDossiers">
          </div>
          <div class="octo-field">
            <label for="octo-bookkeeping-bank">Bankmodules (boekhouding)</label>
            <input type="number" id="octo-bookkeeping-bank" min="0" value="0" data-field="accountingBankQty">
          </div>
          <div class="octo-field">
            <label for="octo-bookkeeping-fact">Facturatiemodules (op boekhouding)</label>
            <input type="number" id="octo-bookkeeping-fact" min="0" value="0" data-field="accountingFactQty">
          </div>
          <div class="octo-field">
            <label for="octo-dms-gb">Extra DMS-opslag (GB &gt; 1)</label>
            <input type="number" id="octo-dms-gb" min="0" step="0.5" value="0" data-field="dmsGb">
          </div>
          <div class="octo-field">
            <label for="octo-offertes">Offertes & leveringsnota's</label>
            <input type="number" id="octo-offertes" min="0" value="0" data-field="offertesQty">
          </div>
          <div class="octo-field">
            <label for="octo-opstart">Nieuwe licenties (opstart &euro;50)</label>
            <input type="number" id="octo-opstart" min="0" value="0" data-field="onboardingQty">
            <small class="octo-note">Niet van toepassing bij K-dossiers.</small>
          </div>
        </div>
      </div>

      <div class="octo-panel octo-hidden" data-section="b">
        <div class="octo-chip">B-dossiers (accountantslicentie)</div>
        <div class="octo-fields">
          <div class="octo-field">
            <label for="octo-b-dossiers"># interne dossiers</label>
            <input type="number" id="octo-b-dossiers" min="0" value="5" data-field="bDossiers">
            <small class="octo-note">Min. 5 dossiers, 1 intern dossier gratis incl. modules.</small>
          </div>
          <div class="octo-field">
            <label for="octo-b-full-option">Full Option dossiers</label>
            <input type="number" id="octo-b-full-option" min="0" value="0" data-field="bFullOption">
          </div>
          <div class="octo-field">
            <label for="octo-b-bank">Bankmodules</label>
            <input type="number" id="octo-b-bank" min="0" value="0" data-field="bBankQty">
          </div>
          <div class="octo-field">
            <label for="octo-b-web">Webservice (API) modules</label>
            <input type="number" id="octo-b-web" min="0" value="0" data-field="bApiQty">
          </div>
          <div class="octo-field">
            <label for="octo-b-dms">Extra DMS-opslag (GB)</label>
            <input type="number" id="octo-b-dms" min="0" step="0.5" value="0" data-field="bDmsGb">
          </div>
          <div class="octo-field">
            <label for="octo-b-archive">Archiveringsmodules</label>
            <input type="number" id="octo-b-archive" min="0" value="0" data-field="archiveQty">
            <small class="octo-note">&euro;12/jaar per dossier na stopzetting.</small>
          </div>
          <div class="octo-field">
            <label class="octo-check">
              <input type="checkbox" data-field="bOnboarding" checked>
              Opstartkost B-licentie (&euro;100)
            </label>
          </div>
        </div>
        <p class="octo-note">Peppol en de ondernemersportaal-API blijven gratis voor ondernemers. Bankkosten van de bank (CODA) zijn niet inbegrepen.</p>
        <details class="octo-faq">
          <summary>Pro-tip voor B-dossiers</summary>
          <ul>
            <li>Documenteer welke interne dossiers het gratis full-option pakket gebruiken.</li>
            <li>API-modules zijn populair bij kantoren met integraties: check of er al een koppeling actief is.</li>
            <li>Stem archiveringsmodules af met het kantoorbeheer: facturatie start na stopzetting.</li>
          </ul>
        </details>
      </div>

      <div class="octo-panel">
        <div class="octo-chip">Extra diensten</div>
        <div class="octo-fields">
          <div class="octo-field">
            <label for="octo-webinar">Webinars (gratis)</label>
            <input type="number" id="octo-webinar" min="0" value="0" data-field="webinarQty">
          </div>
          <div class="octo-field">
            <label for="octo-training-hours">Opleiding ter plaatse (uren)</label>
            <input type="number" id="octo-training-hours" min="0" step="0.5" value="0" data-field="trainingHours">
            <small class="octo-note">&euro;125 per gestart uur.</small>
          </div>
          <div class="octo-field">
            <label for="octo-support-hours">Extra support (uren)</label>
            <input type="number" id="octo-support-hours" min="0" step="0.5" value="0" data-field="supportHours">
            <small class="octo-note">&euro;75 per gestart uur.</small>
          </div>
          <div class="octo-field">
            <label for="octo-consult-weeks">Consultatie-toegang (weken)</label>
            <input type="number" id="octo-consult-weeks" min="0" value="0" data-field="consultWeeks">
            <small class="octo-note">&euro;100 per week.</small>
          </div>
          <div class="octo-field">
            <label for="octo-backup-count">Offline backup herstellen</label>
            <input type="number" id="octo-backup-count" min="0" value="0" data-field="backupQty">
            <small class="octo-note">&euro;200 per dossier/week.</small>
          </div>
        </div>
        <details class="octo-faq">
          <summary>Wanneer gebruik ik deze diensten?</summary>
          <ul>
            <li>Plan een onsite opleiding wanneer een team of ondernemer extra begeleiding nodig heeft.</li>
            <li>Extra supporturen zijn ideaal om complexe migraties of fiscale piekperiodes op te vangen.</li>
            <li>Offline backups inzetten bij audits of bij het herstellen van historische gegevens.</li>
          </ul>
        </details>
        <details class="octo-faq">
          <summary>Handige notities voor offertes</summary>
          <ul>
            <li>Vermeld altijd de uur- of weekprijs in de offerte om verrassingen te voorkomen.</li>
            <li>Combineer meerdere diensten in één offerte en verwijs naar de breakdown rechts.</li>
            <li>Onzeker? Raadpleeg het team #pricing in Teams voor uitzonderingen of maatwerk.</li>
          </ul>
        </details>
      </div>
    </div>

    <aside class="octo-summary">
      <div>
        <h3>Resultaat</h3>
        <p class="octo-tagline">Update automatisch bij elke wijziging.</p>
      </div>
      <div class="octo-quickstart">
        <strong>Snelstart voor nieuwe collega's</strong>
        <ol>
          <li>Bevestig met de klant of het om een U-, K- of B-dossier gaat.</li>
          <li>Noteer het aantal dossiers en modules en vul de velden in voor een live prijsindicatie.</li>
          <li>Gebruik de breakdown hieronder als bron voor je offerte of CRM-opvolging.</li>
        </ol>
      </div>
      <div class="octo-totals">
        <div>
          Per maand
          <span id="octo-monthly">&euro;0</span>
        </div>
        <div>
          Per jaar
          <span id="octo-yearly">&euro;0</span>
        </div>
        <div>
          Eenmalig
          <span id="octo-onetime">&euro;0</span>
        </div>
      </div>
      <div>
        <strong>Kostenposten</strong>
        <ul class="octo-breakdown" id="octo-breakdown"></ul>
      </div>
      <div class="octo-tip">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M8 1.333a6.667 6.667 0 1 1 0 13.334A6.667 6.667 0 0 1 8 1.333Z" stroke="#306b91" stroke-width="1.2"/>
          <path d="M6.667 6.667A1.333 1.333 0 0 1 8 5.333c.737 0 1.333.597 1.333 1.334 0 .737-.596 1.333-1.333 1.333v1.333" stroke="#306b91" stroke-width="1.2" stroke-linecap="round"/>
          <circle cx="8" cy="11.333" r="0.667" fill="#306b91"/>
        </svg>
        <span>Gebruik exporteer- of kopieerfuncties van je CRM om deze cijfers mee te nemen naar de definitieve offerte.</span>
      </div>
      <p class="octo-note">
        Tarieven gebaseerd op interne richtlijnen 2024-2025 voor Octopus (bankkosten der banken niet inbegrepen).
        Naast deze modules blijven API/webservice, Peppol en webinars gratis.
      </p>
    </aside>
  </div>
</div>

<script>
  (function () {
    const root = document.querySelector('[data-octo-calculator]');
    if (!root) return;

    const els = {
      monthly: root.querySelector('#octo-monthly'),
      yearly: root.querySelector('#octo-yearly'),
      oneTime: root.querySelector('#octo-onetime'),
      breakdown: root.querySelector('#octo-breakdown'),
      dossierType: root.querySelector('[data-field="dossierType"]'),
      guide: root.querySelector('#octo-guide'),
      sections: {
        uk: root.querySelector('[data-section="uk"]'),
        b: root.querySelector('[data-section="b"]')
      }
    };

    const onboardingField = root.querySelector('[data-field="onboardingQty"]');
    const state = {
      onboardingTouched: false,
      lastProfile: null
    };

    if (onboardingField) {
      const markOnboardingTouched = function () {
        state.onboardingTouched = onboardingField.value !== '';
      };
      onboardingField.addEventListener('input', markOnboardingTouched);
      onboardingField.addEventListener('change', markOnboardingTouched);
    }

    const PROFILES = {
      u: {
        label: 'U-dossier',
        portal: { monthly: 10, yearly: 120, extraLines: { monthly: 5, yearly: 60 }, extraPack: { monthly: 5, yearly: 60 }, bank: { monthly: 10, yearly: 120 } },
        bookkeeping: {
          small: { monthly: 21, yearly: 252 },
          medium: { monthly: 32, yearly: 384 },
          large: { monthly: 42, yearly: 504 },
          extraLines: { monthly: 10, yearly: 120 },
          extraPack: { monthly: 10, yearly: 120 },
          bank: { monthly: 10, yearly: 120 },
          fact: { monthly: 10, yearly: 120 }
        },
        dms: { monthly: 1, yearly: 12 },
        offertes: 50,
        onboarding: 50
      },
      k: {
        label: 'K-dossier (~20% korting)',
        portal: { monthly: 8, yearly: 96, extraLines: { monthly: 4, yearly: 48 }, extraPack: { monthly: 4, yearly: 48 }, bank: { monthly: 8, yearly: 96 } },
        bookkeeping: {
          small: { monthly: 16.8, yearly: 201.6 },
          medium: { monthly: 25.6, yearly: 307.2 },
          large: { monthly: 33.6, yearly: 403.2 },
          extraLines: { monthly: 8, yearly: 96 },
          extraPack: { monthly: 8, yearly: 96 },
          bank: { monthly: 8, yearly: 96 },
          fact: { monthly: 8, yearly: 96 }
        },
        dms: { monthly: 0.8, yearly: 9.6 },
        offertes: 40,
        onboarding: 0
      }
    };

    const GUIDE_CONTENT = {
      u: {
        title: 'Zo werkt dit profiel:',
        bullets: [
          'U-dossiers zijn bedoeld voor ondernemers die hun licentie zelf betalen en standaard een opstartkost hebben.',
          'Bank-, facturatie- en extra lijnmodules kan je per dossier activeren wanneer de klant groeit.',
          'Gebruik webinars als gratis add-on: ze staan standaard op &euro;0 in de calculator.'
        ],
        note: 'Controleer altijd of het klantnummer al bestaat om dubbele facturatie te vermijden.'
      },
      k: {
        title: 'Zo werkt dit profiel:',
        bullets: [
          'K-dossiers lopen via het kantoor en genieten automatisch ~20% korting op licenties en modules.',
          'Er zijn geen opstartkosten: gebruik het veld "Nieuwe licenties" enkel ter info wanneer nodig.',
          'Combineer meerdere dossiers in één keer om bundelkortingen ten volle te benutten.'
        ],
        note: 'Tip: noteer meteen de verantwoordelijke dossierbeheerder in je CRM voor een vlotte opvolging.'
      },
      b: {
        title: 'Zo werkt dit profiel:',
        bullets: [
          'B-dossiers zijn accountantslicenties met een minimum van 5 interne dossiers (waarvan 1 gratis full option).',
          'Voer enkel extra full option dossiers of modules in bovenop het standaardpakket.',
          'Archivering en extra DMS-opslag worden apart gefactureerd: stem dit af met het kantoor.'
        ],
        note: 'Vergeet niet om de opstartkost uit te vinken als het kantoor eerder al betaalde.'
      },
      default: {
        title: 'Zo werkt dit profiel:',
        bullets: [
          'Kies een dossiertype om meer uitleg te zien en vul vervolgens de relevante velden in.',
          'Alle bedragen worden automatisch omgerekend naar maand, jaar en eenmalige kosten.',
          'Gebruik de breakdown aan de rechterzijde om je offerte te onderbouwen.'
        ],
        note: ''
      }
    };

    const formatCurrency = (value) => {
      return new Intl.NumberFormat('nl-BE', { style: 'currency', currency: 'EUR', minimumFractionDigits: 2 }).format(value);
    };

    const sanitizeNumber = (input) => {
      const value = typeof input === 'number' ? input : parseFloat(input);
      return Number.isFinite(value) ? Math.max(0, value) : 0;
    };

    const ceilIfNeeded = (value) => Math.ceil(sanitizeNumber(value));

    const getFieldValue = (name) => {
      const el = root.querySelector('[data-field="' + name + '"]');
      if (!el) return 0;
      if (el.type === 'checkbox') return el.checked;
      return sanitizeNumber(el.value);
    };

    const ensureOnboardingDefaults = (type) => {
      if (!onboardingField) return;
      if (type === 'u') {
        const portalQty = getFieldValue('portalQty');
        const bookkeepingQty =
          getFieldValue('smallQty') +
          getFieldValue('mediumQty') +
          getFieldValue('largeQty');
        const targetQty = Math.max(portalQty, bookkeepingQty);
        if (!state.onboardingTouched) {
          onboardingField.value = targetQty > 0 ? targetQty : 0;
        }
      } else if (!state.onboardingTouched) {
        onboardingField.value = 0;
      }
    };

    const renderGuide = (type) => {
      if (!els.guide) return;
      const data = GUIDE_CONTENT[type] || GUIDE_CONTENT.default;
      const items = (data.bullets || [])
        .map(function (item) {
          return '<li>' + item + '</li>';
        })
        .join('');
      const note = data.note ? '<p class="octo-tagline">' + data.note + '</p>' : '';
      els.guide.innerHTML = '<strong>' + data.title + '</strong><ul>' + items + '</ul>' + note;
    };

    const updateVisibility = (type) => {
      const showUK = type === 'u' || type === 'k';
      if (els.sections.uk) els.sections.uk.classList.toggle('octo-hidden', !showUK);
      if (els.sections.b) els.sections.b.classList.toggle('octo-hidden', type !== 'b');
    };

    const animateTotals = () => {
      [els.monthly, els.yearly, els.oneTime].forEach(function (span) {
        if (!span) return;
        const card = span.parentElement;
        span.classList.remove('is-updating');
        if (card) card.classList.remove('is-lifted');
        void span.offsetWidth;
        span.classList.add('is-updating');
        if (card) {
          card.classList.add('is-lifted');
          setTimeout(function () {
            card.classList.remove('is-lifted');
          }, 420);
        }
        setTimeout(function () {
          span.classList.remove('is-updating');
        }, 420);
      });
    };

    const addLine = (lines, config) => {
      const entry = Object.assign({ monthly: 0, yearly: 0, oneTime: 0 }, config);
      if (entry.monthly === 0 && entry.yearly === 0 && entry.oneTime === 0) return;
      lines.push(entry);
    };

    const calculateUK = (type) => {
      const profile = PROFILES[type];
      const lines = [];
      let monthly = 0;
      let yearly = 0;
      let oneTime = 0;

      const portalQty = getFieldValue('portalQty');
      if (portalQty > 0) {
        const m = portalQty * profile.portal.monthly;
        const y = portalQty * profile.portal.yearly;
        monthly += m;
        yearly += y;
        addLine(lines, { label: 'Klantenportaal x ' + portalQty, monthly: m, yearly: y });
      }

      const portalExtraLines = getFieldValue('portalExtraLines');
      if (portalExtraLines > 0) {
        const m = portalExtraLines * profile.portal.extraLines.monthly;
        const y = portalExtraLines * profile.portal.extraLines.yearly;
        monthly += m;
        yearly += y;
        addLine(lines, { label: 'Extra lijnbundels klantenportaal x ' + portalExtraLines, monthly: m, yearly: y });
      }

      const portalExtraPacks = getFieldValue('portalExtraPacks');
      if (portalExtraPacks > 0) {
        const m = portalExtraPacks * profile.portal.extraPack.monthly;
        const y = portalExtraPacks * profile.portal.extraPack.yearly;
        monthly += m;
        yearly += y;
        addLine(lines, { label: 'Multi-dossier pakket klantenportaal x ' + portalExtraPacks, monthly: m, yearly: y });
      }

      const portalBankQty = getFieldValue('portalBankQty');
      if (portalBankQty > 0) {
        const m = portalBankQty * profile.portal.bank.monthly;
        const y = portalBankQty * profile.portal.bank.yearly;
        monthly += m;
        yearly += y;
        addLine(lines, { label: 'Bankmodule klantenportaal x ' + portalBankQty, monthly: m, yearly: y });
      }

      const smallQty = getFieldValue('smallQty');
      if (smallQty > 0) {
        const m = smallQty * profile.bookkeeping.small.monthly;
        const y = smallQty * profile.bookkeeping.small.yearly;
        monthly += m;
        yearly += y;
        addLine(lines, { label: 'Boekhouding Small x ' + smallQty, monthly: m, yearly: y });
      }

      const mediumQty = getFieldValue('mediumQty');
      if (mediumQty > 0) {
        const m = mediumQty * profile.bookkeeping.medium.monthly;
        const y = mediumQty * profile.bookkeeping.medium.yearly;
        monthly += m;
        yearly += y;
        addLine(lines, { label: 'Boekhouding Medium x ' + mediumQty, monthly: m, yearly: y });
      }

      const largeQty = getFieldValue('largeQty');
      if (largeQty > 0) {
        const m = largeQty * profile.bookkeeping.large.monthly;
        const y = largeQty * profile.bookkeeping.large.yearly;
        monthly += m;
        yearly += y;
        addLine(lines, { label: 'Boekhouding Large x ' + largeQty, monthly: m, yearly: y });
      }

      const accountingExtraPacks = getFieldValue('accountingExtraPacks');
      if (accountingExtraPacks > 0) {
        const m = accountingExtraPacks * profile.bookkeeping.extraLines.monthly;
        const y = accountingExtraPacks * profile.bookkeeping.extraLines.yearly;
        monthly += m;
        yearly += y;
        addLine(lines, { label: 'Extra lijnbundels boekhouding x ' + accountingExtraPacks, monthly: m, yearly: y });
      }

      const accountingExtraPacksDossiers = getFieldValue('accountingExtraPacksDossiers');
      if (accountingExtraPacksDossiers > 0) {
        const m = accountingExtraPacksDossiers * profile.bookkeeping.extraPack.monthly;
        const y = accountingExtraPacksDossiers * profile.bookkeeping.extraPack.yearly;
        monthly += m;
        yearly += y;
        addLine(lines, { label: 'Extra dossierpakket boekhouding x ' + accountingExtraPacksDossiers, monthly: m, yearly: y });
      }

      const accountingBankQty = getFieldValue('accountingBankQty');
      if (accountingBankQty > 0) {
        const m = accountingBankQty * profile.bookkeeping.bank.monthly;
        const y = accountingBankQty * profile.bookkeeping.bank.yearly;
        monthly += m;
        yearly += y;
        addLine(lines, { label: 'Bankmodule boekhouding x ' + accountingBankQty, monthly: m, yearly: y });
      }

      const accountingFactQty = getFieldValue('accountingFactQty');
      if (accountingFactQty > 0) {
        const m = accountingFactQty * profile.bookkeeping.fact.monthly;
        const y = accountingFactQty * profile.bookkeeping.fact.yearly;
        monthly += m;
        yearly += y;
        addLine(lines, { label: 'Facturatiemodule op boekhouding x ' + accountingFactQty, monthly: m, yearly: y });
      }

      const dmsGb = getFieldValue('dmsGb');
      if (dmsGb > 0) {
        const m = dmsGb * profile.dms.monthly;
        const y = dmsGb * profile.dms.yearly;
        monthly += m;
        yearly += y;
        addLine(lines, { label: 'Extra DMS-opslag ' + dmsGb + ' GB', monthly: m, yearly: y });
      }

      const offertesQty = getFieldValue('offertesQty');
      if (offertesQty > 0) {
        const cost = offertesQty * profile.offertes;
        oneTime += cost;
        addLine(lines, { label: 'Offertes & leveringsnota\'s x ' + offertesQty, oneTime: cost });
      }

      const onboardingQty = getFieldValue('onboardingQty');
      if (onboardingQty > 0 && profile.onboarding > 0) {
        const cost = onboardingQty * profile.onboarding;
        oneTime += cost;
        addLine(lines, { label: 'Opstartkost x ' + onboardingQty, oneTime: cost });
      }

      return { monthly, yearly, oneTime, lines };
    };

    const calculateB = () => {
      const lines = [];
      let monthly = 0;
      let yearly = 0;
      let oneTime = 0;

      const dossiersField = root.querySelector('[data-field="bDossiers"]');
      const rawDossiers = getFieldValue('bDossiers');
      const normalizedDossiers = Math.max(Math.round(rawDossiers), 0);
      const minimumDossiers = Math.max(normalizedDossiers, 5);
      if (dossiersField && Number(dossiersField.value) !== minimumDossiers) {
        dossiersField.value = minimumDossiers;
      }

      const freeDossiers = minimumDossiers > 0 ? 1 : 0;
      const chargeableDossiers = Math.max(minimumDossiers - freeDossiers, 0);
      if (freeDossiers > 0) {
        lines.push({ label: 'Gratis intern dossier (incl. modules)', monthly: 0, yearly: 0, oneTime: 0, free: true });
      }

      const tierOne = Math.min(chargeableDossiers, 50);
      const tierTwo = Math.max(chargeableDossiers - 50, 0);
      if (tierOne > 0) {
        const y = tierOne * 15;
        const m = y / 12;
        yearly += y;
        monthly += m;
        addLine(lines, { label: 'B-dossiers (betalend) 1-50 x ' + tierOne, monthly: m, yearly: y });
      }
      if (tierTwo > 0) {
        const y = tierTwo * 10;
        const m = y / 12;
        yearly += y;
        monthly += m;
        addLine(lines, { label: 'B-dossiers (betalend) vanaf 51 x ' + tierTwo, monthly: m, yearly: y });
      }

      const normalizeModuleCount = (value) => Math.max(Math.round(Math.min(value, minimumDossiers)), 0);
      const payableModuleUnits = (value) => Math.max(normalizeModuleCount(value) - freeDossiers, 0);

      const fullOptionUnits = payableModuleUnits(getFieldValue('bFullOption'));
      if (fullOptionUnits > 0) {
        const m = fullOptionUnits * 3.5;
        const y = m * 12;
        monthly += m;
        yearly += y;
        addLine(lines, { label: 'Full Option pakketten x ' + fullOptionUnits, monthly: m, yearly: y });
      }

      const bankUnits = payableModuleUnits(getFieldValue('bBankQty'));
      if (bankUnits > 0) {
        const y = bankUnits * 5;
        const m = y / 12;
        yearly += y;
        monthly += m;
        addLine(lines, { label: 'Bankmodule x ' + bankUnits, monthly: m, yearly: y });
      }

      const apiUnits = payableModuleUnits(getFieldValue('bApiQty'));
      if (apiUnits > 0) {
        const y = apiUnits * 10;
        const m = y / 12;
        yearly += y;
        monthly += m;
        addLine(lines, { label: 'Webservice/API x ' + apiUnits, monthly: m, yearly: y });
      }

      const dmsGb = getFieldValue('bDmsGb');
      if (dmsGb > 0) {
        const m = dmsGb * 1;
        const y = dmsGb * 12;
        monthly += m;
        yearly += y;
        addLine(lines, { label: 'Extra DMS-opslag ' + dmsGb + ' GB', monthly: m, yearly: y });
      }

      const archiveQty = payableModuleUnits(getFieldValue('archiveQty'));
      if (archiveQty > 0) {
        const y = archiveQty * 12;
        const m = y / 12;
        yearly += y;
        monthly += m;
        addLine(lines, { label: 'Archiveringsmodule x ' + archiveQty, monthly: m, yearly: y });
      }

      if (getFieldValue('bOnboarding')) {
        oneTime += 100;
        addLine(lines, { label: 'Opstartkost B-licentie', oneTime: 100 });
      }

      return { monthly, yearly, oneTime, lines };
    };

    const calculateExtras = () => {
      const lines = [];
      let oneTime = 0;

      const trainingHours = getFieldValue('trainingHours');
      if (trainingHours > 0) {
        const units = ceilIfNeeded(trainingHours);
        const cost = units * 125;
        oneTime += cost;
        addLine(lines, { label: 'Opleiding ter plaatse (' + units + ' uur)', oneTime: cost });
      }

      const supportHours = getFieldValue('supportHours');
      if (supportHours > 0) {
        const units = ceilIfNeeded(supportHours);
        const cost = units * 75;
        oneTime += cost;
        addLine(lines, { label: 'Extra support (' + units + ' uur)', oneTime: cost });
      }

      const consultWeeks = getFieldValue('consultWeeks');
      if (consultWeeks > 0) {
        const cost = consultWeeks * 100;
        oneTime += cost;
        addLine(lines, { label: 'Consultatie-toegang (' + consultWeeks + ' week/weken)', oneTime: cost });
      }

      const backupQty = getFieldValue('backupQty');
      if (backupQty > 0) {
        const cost = backupQty * 200;
        oneTime += cost;
        addLine(lines, { label: 'Offline backup herstellen x ' + backupQty, oneTime: cost });
      }

      return { oneTime, lines };
    };

    const renderResult = () => {
      const type = els.dossierType ? els.dossierType.value : 'default';
      if (state.lastProfile !== type) {
        state.onboardingTouched = false;
        state.lastProfile = type;
      }

      updateVisibility(type);
      renderGuide(type);
      ensureOnboardingDefaults(type);

      const totals = { monthly: 0, yearly: 0, oneTime: 0 };
      const lines = [];

      if (type === 'u' || type === 'k') {
        const res = calculateUK(type);
        totals.monthly += res.monthly;
        totals.yearly += res.yearly;
        totals.oneTime += res.oneTime;
        lines.push(...res.lines);
      } else {
        const res = calculateB();
        totals.monthly += res.monthly;
        totals.yearly += res.yearly;
        totals.oneTime += res.oneTime;
        lines.push(...res.lines);
      }

      const extras = calculateExtras();
      totals.oneTime += extras.oneTime;
      lines.push(...extras.lines);

      els.monthly.textContent = formatCurrency(totals.monthly);
      els.yearly.textContent = formatCurrency(totals.yearly);
      els.oneTime.textContent = formatCurrency(totals.oneTime);
      animateTotals();

      if (lines.length === 0) {
        els.breakdown.innerHTML = '<li>Geen kosten geselecteerd.</li>';
        return;
      }

      els.breakdown.innerHTML = lines.map(function (item) {
        if (item.free) {
          return '<li><strong>' + item.label + '</strong><br>Gratis inbegrepen</li>';
        }
        if (item.oneTime > 0 && item.monthly === 0 && item.yearly === 0) {
          return '<li><strong>' + item.label + '</strong><br>Eenmalig ' + formatCurrency(item.oneTime) + '</li>';
        }
        const recurring = formatCurrency(item.monthly) + ' / maand | ' + formatCurrency(item.yearly) + ' / jaar';
        if (item.oneTime > 0) {
          return '<li><strong>' + item.label + '</strong><br>' + recurring + '<br>+ eenmalig ' + formatCurrency(item.oneTime) + '</li>';
        }
        return '<li><strong>' + item.label + '</strong><br>' + recurring + '</li>';
      }).join('');
    };

    const inputs = root.querySelectorAll('[data-field]');
    inputs.forEach(function (input) {
      input.addEventListener('input', renderResult);
      input.addEventListener('change', renderResult);
    });

    renderResult();
  })();
</script>
